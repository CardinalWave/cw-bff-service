
<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>CardinalWave</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <title>CardinalWave</title>
    <style>
      body {
        font-family: 'Segoe UI', sans-serif;
        background-color: #110F1A;
        margin: 0;
        padding: 0;
        color: #f5f2f2;
        display: block;
        overflow: hidden;
      }

      h3 {
        margin-bottom: 1%;
      }

      h4 {
        margin-bottom: 1%;
      }

      #app {
        max-width: 100%;
        height: 100%;
        margin: auto;
        padding: 20px;
        border-radius: 5px;
      }

      #init{
        margin:auto;
        margin-top: 10rem;
        margin-bottom: 10rem;
        width: 90%;
        padding: 10px;
        border: 1px solid #110f1a8e;
        border-radius: 20px;
        background-color: #2f2d3b;
      }

      .message-container {
	    margin-bottom: 10px;
      }

      .message-container strong {
	    color: #333;
      }

      input {
        width: 100%;
        margin-right: 10px;
        border: 1px solid #ccc;
        border-radius: 3px;
        box-sizing: border-box;
        font-size: 30px;
      }

      .btn-inputs{
        margin-top: 5%;
        display: flex;
        justify-content: space-between; /* Distribui os itens flexíveis com espaçamento entre eles */
        align-items: center; /* Alinha os itens verticalmente ao centro */
      }

      .btn-green {
        text-align: right;
        padding: 10px 40px;
        margin-top:5px;
        background-color: #00ff89;
        color: #1f1f1f;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        font-family: 'Segoe UI', sans-serif;
        font-weight: bold;
        transition: box-shadow 0.3s ease-in-out #00ff8873;
      }
      .btn-green:hover {
        box-shadow: 0 0 3px 4px #00ff8873;
      }
      
      .btn-red {
        text-align: left;
        padding: 10px 40px;
        margin-top:5px;
        background-color: #f75750;
        color: #1f1f1f;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        font-family: 'Segoe UI', sans-serif;
        font-weight: bold;
        transition: box-shadow 0.3s ease-in-out #F7614F;
      }
      .btn-red:hover {
        box-shadow: 0 0 3px 4px #F7614F;
      }
      #chat-list {
        display: none;
      }
      .chat-header {
        width: 100%;
        background-color: #3ac775;
        font-weight: bold;
        text-align: center;
        color: #1f1f1f;
      }
      .user-list {
        padding: 0%;
        list-style-type: none;
      }
      .user-item {
        border-bottom: 1px solid #ccc;
        padding: 10px;
      }

      .user-item:last-child {
        border-bottom: none;
      }

      .user-name {
        font-weight: bold;
      }

      .user-email {
        color: #666;
      }

      #chat {
        width: 100%;
        max-width: 100%;
        background-color: #2f2d3b;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        display: none;
      }
      .chat-box {
        height: 80vh;
        overflow-y: scroll;
        padding: 10px;
        background-color: #3e3c4a;
        border-radius: 10px;
      }

      .message {
        width: 75%;
        margin-bottom: 15px;
        padding: 10px;
        background-color: #4b4860;
        border-radius: 10px;
      }
      .message_name {
        font-weight: bold;
        color: #00ff89;
      }
      .message_date {
        margin: 3%;
        color: #ccc;
      }
      .message_text {
        margin-top: 5px;
        color: #e5e5e5;
      }
      .message_user {
        width: 75%;
        margin-bottom: 15px;
        padding: 10px;
        background-color: #4b4860;
        border-radius: 10px;
        margin-left: 17%;
      }

      .message_user .message_name {
        font-weight: bold;
        color: #a480ff;
      }

      .input-box {
        font-size: 18px;
        display: flex;
        justify-content: space-between;
      }
      .input-box input[type="text"] {
        width: calc(100% - 80px);
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin-top: 8px;
        margin-left: 5px;
        margin-right: 10px;
        height: 28px;
      }
      .input-box button {
        padding: 10px 20px;
        background-color: #00ff89;
        color: #1f1f1f;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
      }
      /* Custom scrollbar styles */
      .chat-box::-webkit-scrollbar {
          width: 12px;
      }
      .chat-box::-webkit-scrollbar-track {
          background: #2f2d3b;
          border-radius: 10px;
      }
      .chat-box::-webkit-scrollbar-thumb {
          background-color: #00ff89;
          border-radius: 10px;
          border: 3px solid #2f2d3b;
      }
      .chat-box::-webkit-scrollbar-thumb:hover {
          background-color: #00cc70;
      }

      :root {
        --offset-size: 10rem;
        --size: -0;
        --border-color: #000000;
        --neon-color: #1EF5F3;
        --neon-color-2: #1BE9C1;
        --neon-color-3: #1BE984;
        --neon-default-color: #910900;
        --neon-secundary: #9ac8b4;
    }

    body {
        min-height: 100vh;
        min-width: 100vw;
    }

    .cardinal {
        /* transform: scale(0.9); */
        background-color: #ffdcb4;
        border: 10px solid #000;
        border-radius: 50%;
        margin-top: 20rem;
        margin-bottom: 12rem;
        margin: auto;
        width: 10em;
        height: 10em;
    }
    
    h1 {
        font-size: 30px;
        /* margin-top: 80%; */
        text-align: center;
    }

    .pixel {
        transform: scale(0.4);
        width: 1rem;
        height: 1rem;
        margin-top: 4rem;
        margin-left: 0.6rem;
        --shadow-color-2: #00ffff;
        --shadow-color-3: #ff0000;
        box-shadow: 
        
        0rem -2rem 0 var(--size) var(--border-color),
        1rem -2rem 0 var(--size) var(--border-color),
        2rem -1rem 0 var(--size) var(--border-color),
        3rem -1rem 0 var(--size) var(--border-color),
        4rem 0rem 0 var(--size) var(--border-color),
        5rem 0rem 0 var(--size) var(--border-color),
        6rem 0rem 0 var(--size) var(--border-color),
        7rem 0rem 0 var(--size) var(--border-color),
        8rem 0rem 0  var(--size) var(--border-color),
        9rem -3rem 0 var(--size) var(--border-color),
        9rem -2rem 0 var(--size) var(--border-color),
        9rem -1rem 0 var(--size) var(--border-color),
        10rem -3rem 0  var(--size) var(--border-color),
        11rem -2rem 0  var(--size) var(--border-color),
        12rem -1rem 0 var(--size) var(--border-color),
        13rem 0rem 0 var(--size) var(--border-color),
        14rem 0rem 0 var(--size) var(--border-color),
        15rem 0rem 0 var(--size) var(--border-color),
        16rem 0rem 0 var(--size) var(--border-color),
        17rem 0rem 0 var(--size) var(--border-color),
        18rem 0rem 0 var(--size) var(--border-color),
        19rem 1rem 0 var(--size) var(--border-color),
        20rem 2rem 0 var(--size) var(--border-color),
        19rem 3rem 0 var(--size) var(--border-color),


        /* Baixo */
        0rem -1rem 0 var(--size) var(--border-color),
        1rem 0rem 0 var(--size) var(--border-color),
        2rem 1rem 0 var(--size) var(--border-color),
        2rem 2rem 0 var(--size) var(--border-color),
        1rem 3rem 0 var(--size) var(--border-color),
        0rem 4rem 0 var(--size) var(--border-color),
        0rem 5rem 0 var(--size) var(--border-color),
        1rem 5rem 0 var(--size) var(--border-color),
        2rem 4rem 0 var(--size) var(--border-color),
        3rem 4rem 0 var(--size) var(--border-color),
        4rem 3rem 0 var(--size) var(--border-color),
        5rem 3rem 0 var(--size) var(--border-color),
        6rem 3rem 0 var(--size) var(--border-color),
        7rem 3rem 0 var(--size) var(--border-color),
        8rem 3rem 0  var(--size) var(--border-color),
        9rem 4rem 0 var(--size) var(--border-color),
        9rem 5rem 0 var(--size) var(--border-color),
        10rem 5rem 0  var(--size) var(--border-color),
        11rem 4rem 0  var(--size) var(--border-color),
        12rem 4rem 0 var(--size) var(--border-color),
        13rem 4rem 0 var(--size) var(--border-color),
        14rem 4rem 0 var(--size) var(--border-color),
        15rem 4rem 0 var(--size) var(--border-color),
        16rem 4rem 0 var(--size) var(--border-color),
        17rem 4rem 0 var(--size) var(--border-color),
        18rem 4rem 0 var(--size) var(--border-color),

        /* Cores */
        4rem 1rem 0 var(--size) var(--neon-color),
        5rem 1rem 0 var(--size) var(--neon-color),
        6rem 1rem 0 var(--size) var(--neon-color),
        7rem 1rem 0 var(--size) var(--neon-color),
        8rem 1rem 0 var(--size) var(--neon-color),
        9rem 1rem 0 var(--size) var(--neon-color),
        10rem 1rem 0 var(--size) var(--neon-color),
        11rem 1rem 0 var(--size) var(--neon-color),
        12rem 1rem 0 var(--size) var(--neon-color),
        13rem 1rem 0 var(--size) var(--neon-color),
        14rem 1rem 0 var(--size) var(--neon-color),
        15rem 1rem 0 var(--size) var(--neon-color),
        16rem 1rem 0 var(--size) var(--neon-color),
        17rem 1rem 0 var(--size) var(--neon-color),
        18rem 1rem 0 var(--size) var(--neon-color),
        4rem 1rem 0 var(--size) var(--neon-color),

        4rem 2rem 0 var(--size) var(--neon-default-color),
        5rem 2rem 0 var(--size) var(--neon-default-color),
        6rem 2rem 0 var(--size) var(--neon-default-color),
        7rem 2rem 0 var(--size) var(--neon-default-color),
        8rem 2rem 0 var(--size) var(--neon-default-color),
        9rem 2rem 0 var(--size) var(--neon-default-color),
        9rem 3rem 0 var(--size) var(--neon-default-color),
        10rem 2rem 0 var(--size) var(--neon-default-color),
        10rem 3rem 0 var(--size) var(--neon-default-color),
        10rem 4rem 0 var(--size) var(--neon-default-color),
        11rem 2rem 0 var(--size) var(--neon-default-color),
        11rem 3rem 0 var(--size) var(--neon-default-color),
        12rem 2rem 0 var(--size) var(--neon-default-color),
        12rem 3rem 0 var(--size) var(--neon-default-color),
        13rem 2rem 0 var(--size) var(--neon-default-color),
        13rem 3rem 0 var(--size) var(--neon-default-color),
        14rem 2rem 0 var(--size) var(--neon-default-color),
        14rem 3rem 0 var(--size) var(--neon-default-color),
        15rem 2rem 0 var(--size) var(--neon-default-color),
        15rem 3rem 0 var(--size) var(--neon-default-color),
        16rem 2rem 0 var(--size) var(--neon-default-color),
        16rem 3rem 0 var(--size) var(--neon-default-color),
        17rem 2rem 0 var(--size) var(--neon-default-color),
        17rem 3rem 0 var(--size) var(--neon-default-color),
        18rem 2rem 0 var(--size) var(--neon-default-color),
        18rem 3rem 0 var(--size) var(--neon-default-color),
        4rem 3rem 0 var(--size) var(--neon-default-color),
        19rem 2rem 0 var(--size) var(--neon-default-color),
        3rem 2rem 0 var(--size) var(--neon-secundary),
        3rem 3rem 0 var(--size) var(--neon-secundary),
        2rem 3rem 0 var(--size) var(--neon-secundary),
        1rem 4rem 0 var(--size) var(--neon-secundary),
        3rem 1rem 0 var(--size) var(--neon-secundary),
        3rem 0rem 0 var(--size) var(--neon-secundary),
        2rem 0rem 0 var(--size) var(--neon-secundary),
        1rem -1rem 0 var(--size) var(--neon-secundary),
        /* // */
        9rem 0rem 0 var(--size) var(--neon-secundary),
        10rem 0rem 0 var(--size) var(--neon-secundary),
        11rem 0rem 0 var(--size) var(--neon-secundary),
        12rem 0rem 0 var(--size) var(--neon-secundary),
        13rem 0rem 0 var(--size) var(--neon-secundary),
        14rem 0rem 0 var(--size) var(--neon-secundary),
        15rem 0rem 0 var(--size) var(--neon-secundary),
        10rem -1rem 0 var(--size) var(--neon-secundary),
        11rem -1rem 0 var(--size) var(--neon-secundary),
        10rem -2rem 0 var(--size) var(--neon-secundary);

        transition: box-shadow 1s ease-in-out;
        animation: mudarCores 5s linear infinite;
    }
    @keyframes mudarCores {
        0%, 100% {
          --neon-color: var(--neon-color);
        }
        50% {
            --neon-color: var(--neon-color-2);
        }
        60% {
            --neon-color: var(--neon-color-3)
        }
    }
    </style>
  </head>
  <body id="body">
  <div id="app">
    <div id="init">
      <div class="cardinal">
        <div class="pixel"></div>
      </div>
      <h1>CardinalWave</h1>
      <div id="login">
        <h3>Usuario</h3>
        <input type="text" id="ipt-user">
        <h3>Senha</h3>
        <input type="password" id="ipt-password">
        <div class="btn-inputs">
          <button id="btn-login" class="btn-green">Entrar</button>
          <button id="btn-register" class="btn-red">Criar</button>
        </div>
      </div>
      <div id="register"></div>
    </div>
    <div id="chat-list">
      <button id="btn-logout" class="btn-red">Sair</button>
      <ul class="user-list">
      </ul>
    </div>
    <div id="chat">
      <div class="chat-header"></div>
      <div class="chat-box" id="chat-box">
      </div>
      <div class="input-box">
        <input type="text" placeholder="Type your message..." id="ipt-message">
        <button id="btn-send">Send</button>
      </div>
  </div>
  <script>
    // - Registrar
    // - Logout do App - Feito
    // - Criar Grupo
    // - Pesquisar Grupo
    // - Ver Usuarios
    // - Entrar No Grupo
    // - Sair do Grupo
    // - Notificar Mensagens

  console.log(window.location.host)
  let token = "";
  // socket = new WebSocket("ws://" + window.location.hostname + ":5000");
  socket = new WebSocket("ws://" + "192.168.15.69"+ ":5003");
  socket.onopen = function(e) { console.log("[socket] socket.onopen ");};
  socket.onerror = function(e) { console.log("[socket] socket.onerror ");};
  function waitForSocketConnection() {
    return new Promise((resolve, reject) => {
        if (socket.readyState === WebSocket.OPEN) {
          resolve();
        } else {
          socket.onopen = () => resolve();
          socket.onerror = (error) => reject(error);
        }
      });
  }
  document.addEventListener('DOMContentLoaded', async function() {
    try {
      await waitForSocketConnection();  // Aguarda a conexão estar aberta
      let section = localStorage.getItem('status');
      if(section === "") {
        localStorage.setItem('status', 'login')
      }
      handleSection(section);
    } catch(error) {
      console.error('WebSocket connection error: ', error);
    }
  });
  function handleSection(section) {
    console.log(section)
    switch (section) {
      case null:
          break;
      case 'chat_list':
          document.getElementById("init").remove();
          showChatList();
          break;
      case 'chat_join':
          document.getElementById("init").remove();
          group_id = sessionStorage.getItem('group_id');
          group_title = sessionStorage.getItem('group_title');
          logoutChat();
          showChat(group_id, group_title);
      default:
          break;
    }
  }
  socket.onmessage = function(e) {
    const message = JSON.parse(e.data);
    console.log(message)
    const payload = message['payload'];
    status = localStorage.getItem('status')
    const action = message['action'];
    console.log(action)
    token = payload['token'];
    if (token !== undefined && status === "login") {
      alert(`Login realizado com sucesso!`);
      localStorage.setItem('userData', JSON.stringify(payload));
      document.getElementById("init").style.display = "none"
      localStorage.setItem('status', 'chat_list')
      showChatList();
    }
    if (status == 'chat_list' || action == 'group_list') {
      const message = JSON.parse(e.data);
      populateUserList(message.payload.groups)
    }
    if (status == 'chat_join') {
      const message = JSON.parse(e.data)
      console.log(message)
      if(message.payload.author !== undefined){
        addMessage(message.payload.author, message.payload.send_time, message.payload.payload)
      }
    }
    if (payload['error']){
      alert(payload['message'])
    }
  };
  function generateId() {
    return "sessionid_" + Math.random().toString(36).substr(2,9);
  }
  function verifySessionId() {
    let sessionId = localStorage.getItem("sessionId");
    if (!sessionId) {
      sessionId = generateId();
      localStorage.setItem("sessionId", sessionId);
    }
      return sessionId;
  }  
  let sessionId = verifySessionId();
  const session = {
    session_id: sessionId,
  };	
  function populateUserList(groups=[]) {
    const userList = document.querySelector('.user-list');
    userList.innerHTML = '';
    groups.forEach(group => {
      const li = document.createElement('li');
      li.className = 'user-item';
      li.onclick = () => handleUserClick(group.group_id, group.title);
      const nameDiv = document.createElement('div');
      nameDiv.className = 'user-name';
      nameDiv.textContent = group.title;
      li.appendChild(nameDiv);
      userList.appendChild(li);
    });
  }
  function formatTime(time) {
    if (typeof time !== 'string') {
      return 'Entrada inválida';
    }
    const timeRegex = /\d{2}:\d{2}/;
    const match = time.match(timeRegex);
    return match ? match[0] : 'Hora não encontrada';
  }
  function addMessage(name, time, text) {
    const messageContainer = document.createElement('div');
    const parseData = JSON.parse(localStorage.getItem('userData'));
    messageContainer.className = 'message';
    if(name == parseData.username){
      messageContainer.className = 'message_user';
    }
    const topDiv = document.createElement('div');
    topDiv.className = 'top';
    const nameLabel = document.createElement('label');
    nameLabel.className = 'message_name';
    nameLabel.textContent = name;
    topDiv.appendChild(nameLabel);
    const dateLabel = document.createElement('label');
    dateLabel.className = 'message_date';
    dateLabel.textContent = formatTime(time);
    topDiv.appendChild(dateLabel);
    messageContainer.appendChild(topDiv);
    const botDiv = document.createElement('div');
    botDiv.className = 'bot';
    const textLabel = document.createElement('label');
    textLabel.className = 'message_text';
    textLabel.textContent = text;
    botDiv.appendChild(textLabel);
    messageContainer.appendChild(botDiv);
    const chatBox = document.getElementById('chat-box');
    chatBox.appendChild(messageContainer);
  }
  function showChatList() {
    let chat_list = document.getElementById('chat-list');
    chat_list.style.display = 'block';
    const str_userData = localStorage.getItem('userData');
    if (str_userData) {
      const parseData = JSON.parse(str_userData)
        const chat_list = {		
        token: parseData.token,
        email: parseData.email,
        username: parseData.username
      }
      session.action = "group_list"
      session.payload = chat_list;
      let request = JSON.stringify(session);
      socket.send(request);
    }
  }
  let btn_login = document.getElementById("btn-login");  
  btn_login.addEventListener("click", function() {
    let ipt_pass = document.getElementById("ipt-password");
    let ipt_user = document.getElementById("ipt-user"); 
    const login = {		
      email:ipt_user.value,
      password:ipt_pass.value
    };
    session.action = "login";
    session.payload = login;
    let request = JSON.stringify(session);
    socket.send(request);
    ipt_user.value = '';
    ipt_pass.value = '';
    localStorage.setItem('status', "login");
  });
  if (document.getElementById("btn-confirm")) {
    let btn_confirm = document.getElementById("btn-confirm");
    btn_confirm.addEventListener("click", function() {
      let ipt_email = document.getElementById("ipt-email");
      let ipt_username = document.getElementById("ipt-username");
      let ipt_password = document.getElementById("ipt-pass");
      let ipt_password_conf = document.getElementById("ipt-pass-conf");
      const register = {
        username: ipt_username.value(),
        email: ipt_email.value(),
        password: ipt_password()
      }
      session.action = "register";
      session.payload = register;
      console.log(session)
      let request = JSON.stringify(session);
      // socket.send(request);
    });
  }

  
  let btn_logout = document.getElementById("btn-logout");
  btn_logout.addEventListener("click", function () {
    const str_userData = localStorage.getItem('userData');
    if (str_userData) {
      const parseData = JSON.parse(str_userData)
      const logout = {		
        token: parseData.token
      }
      console.log(logout)
      session.action = "logout";
      session.payload = logout
      let request = JSON.stringify(session);
      logoutChat();
      socket.send(request);
      localStorage.clear();
      sessionStorage.clear();
      location.reload();
    }
  })
  function showChat(section, title) {
    const elements = document.getElementsByClassName('cardinal');
    while (elements.length > 0) {
      elements[0].parentNode.removeChild(elements[0]);
    }
    let chat_box = document.getElementById('chat');
    let chat_header = document.getElementsByClassName('chat-header');
    if (chat_header.length > 0) {
      chat_header[0].innerHTML = title;
    }
    chat_box.style.display = 'block';
    const str_userData = localStorage.getItem('userData');
    if (str_userData) {
      const parseData = JSON.parse(str_userData)
      const chat_join = {		
      token: parseData.token,
      group_id: section
    }
      session.action = "chat_join"
      session.payload = chat_join;
      let request = JSON.stringify(session);
      socket.send(request);
    }
    localStorage.setItem('status', "chat_join");
    if (window.innerWidth > 768){
      chat_box.style.marginLeft = "20%";
      chat_box.style.width = "80%";
      showChatList()
      chat_list = document.getElementById("chat-list")
      chat_list.style.display = "block";
      chat_list.style.position = "absolute";
      chat_list.style.top = 0;
      chat_list.style.left = 0;
      chat_list.style.width = "20%";
    }
  }
  let btn_send = document.getElementById("btn-send");  
  btn_send.addEventListener("click", function() {
    let ipt_message = document.getElementById("ipt-message");
    const parseData = JSON.parse(localStorage.getItem('userData'))
    const message = {
      token:parseData.token,
      message:ipt_message.value
    };
    session.action = "chat_send"
    session.payload = message;
    let request = JSON.stringify(session);	
    socket.send(request);
   });
  let btn_register = document.getElementById("btn-register");
  btn_register.addEventListener("click", function() {
    document.getElementById("login").style.display = "none";
    let register_box = document.getElementById("register");
    const lb_email = document.createElement('h3');
    lb_email.textContent= 'Email';
    register_box.appendChild(lb_email);
    const ipt_email = document.createElement('input');
    register_box.appendChild(ipt_email);
    const lb_username = document.createElement('h3');
    lb_username.textContent = 'Username';
    register_box.appendChild(lb_username);
    const ipt_username = document.createElement('input');
    register_box.appendChild(ipt_username);
    const lb_senha = document.createElement('h3');
    lb_senha.textContent = 'Senha';
    register_box.appendChild(lb_senha);
    const ipt_senha = document.createElement('input');
    register_box.appendChild(ipt_senha);
    const lb_senha_conf = document.createElement('h4');
    lb_senha_conf.textContent = 'Confirme a sua senha';
    register_box.appendChild(lb_senha_conf);
    const ipt_senha_conf = document.createElement('input');
    register_box.appendChild(ipt_senha_conf)
    const input_box = document.createElement('div');
    const btn_confirm = document.createElement('button');
    btn_confirm.className = 'btn-green';
    btn_confirm.id = 'btn-confirm';
    btn_confirm.textContent = 'Entrar';
    input_box.appendChild(btn_confirm);
    const btn_cancelar = document.createElement('button');
    btn_cancelar.className = 'btn-red';
    btn_cancelar.textContent = 'Limpar';
    btn_cancelar.id = 'btn-cancelar';
    input_box.className = "btn-inputs";
    input_box.appendChild(btn_cancelar);
    register_box.appendChild(input_box)
  });
  function handleUserClick(section, title) {
    if (sessionStorage.getItem('group_id') || sessionStorage.getItem('group_title')){
      logoutChat();
      clearChat();
    }
    showChat(section, title);
    sessionStorage.setItem('group_id', section);
    sessionStorage.setItem('group_title', title);
    chat_list = document.getElementById("chat-list")
    if (window.innerWidth > 768) {
      chat_list.style.display = "block";
      chat_list.style.position = "absolute";
      chat_list.style.top = 0;
      chat_list.style.left = 0;
      chat_list.style.width = "20%";
    } else {
      chat_list.style.display = "none";
    }
  }
  function logoutChat(){
    const parseData = JSON.parse(localStorage.getItem('userData'));
    const group_id = sessionStorage.getItem('group_id')
    const logout = {
      token: parseData.token,
      group_id: group_id
    };
    session.action = "chat_leave";
    session.payload = logout;
    let request = JSON.stringify(session);
    socket.send(request);
  }
  function clearChat() {
    let chat_box = document.getElementById('chat-box')
    let chat_header = document.getElementsByClassName('chat-header')
    while (chat_box.firstChild){ 
      chat_box.removeChild(chat_box.firstChild);
    }
  }
  function handleTouchStart(event) {
    startX = event.touches[0].clientX; // Captura a posição X inicial do toque
  }
  function handleTouchMove(event) {
    if (!startX) return;
    if (status === 'chat_join') {
      const currentX = event.touches[0].clientX;
      const distance = currentX - startX;
      if (distance > 150) { 
        let chat = document.getElementById('chat');
        chat.style.display = "none";
        showChatList();
      }
    }
  }
  function windowMinimal() {
    if(window.innerWidth < 768) {
      document.addEventListener('touchstart', handleTouchStart);
      document.addEventListener('touchmove', handleTouchMove);
    }
    if(window.innerWidth > 768) {
      let init = document.getElementById("init");
      init.style.width = "20%";
    }
  }
  windowMinimal();
    
  </script>
 </body>
</html>
